dnl Process this file with 'autoconf' to produce a 'configure' script
dnl $Header: /users/source/archives/td_lib.vcs/RCS/configure.in,v 12.32 1994/07/16 16:14:02 tom Exp $
AC_REVISION($Revision: 12.32 $)
AC_INIT(include/td_lib.h)

###	program paths
AC_PROG_CC
AC_PROG_CPP
AC_PROG_INSTALL
TD_RCS_SCCS
AC_PROGRAM_PATH(MAKE,make,make)
AC_PROGRAM_PATH(RANLIB,ranlib,echo)

###	extra things that we'll substitute in the makefile
AC_SUBST(CC_OPTS)
AC_SUBST(INCLUDES)
AC_SUBST(MAKE)
AC_SUBST(RANLIB)

###	use option -with-warnings to turn on all gcc warnings
CC_OPTS="$CFLAGS"
if test -n "$GCC"
then
	if test -n "$with_warnings"
	then
CC_OPTS="$CC_OPTS -Wshadow -Wconversion -Wstrict-prototypes -Wmissing-prototypes"
	fi
CC_OPTS="$CC_OPTS -Wall"
fi

AC_CONST
AC_STDC_HEADERS
AC_DIR_HEADER
AC_MAJOR_HEADER
AC_RETSIGTYPE
TD_SIG_ARGS
TD_REGEX
TD_ANSI_CPP
TD_STAT_ST_BLOCKS

### This may alter include-path
dnl:TD_CURSES_LIBS
AC_HAVE_LIBRARY(curses)
AC_HAVE_LIBRARY(termcap)

AC_HAVE_HEADERS(stdlib.h unistd.h string.h memory.h pwd.h)
AC_HAVE_HEADERS(stdarg.h varargs.h)
AC_HAVE_HEADERS(file.h fcntl.h ioctl.h)
dnl don't combine <file.h> and <sys/file.h>, because autoconf gets confused
AC_HAVE_HEADERS(sys/file.h sys/fcntl.h sys/ioctl.h)
AC_HAVE_HEADERS(termcap.h termios.h termio.h sgtty.h utime.h)

AC_HAVE_LIBRARY(bsd, [LIBS="$LIBS -lbsd"])

TD_WAIT
TD_SIZE_T
TD_CURSES_FUNCS

# We're done looking for libraries and header files.  Find the functions and
# datatypes

### Functions (use TD_HAVE_FUNCS for debugging)
TD_HAVE_FUNCS(
_exit \
_filbuf \
_flsbuf \
beep \
bzero \
calloc \
closedir \
creat \
endgrent \
endpwent \
execvp \
exit \
fclose \
fflush \
fgetc \
fork \
fprintf \
fputc \
fputs \
fread \
free \
fscanf \
fseek \
fwrite \
getcwd \
getegid \
getenv \
geteuid \
getgid \
getgrent \
getgrgid \
getgrnam \
getopt \
getpwent \
getpwnam \
getpwuid \
gettimeofday \
getuid \
getwd \
has_colors \
intrflush \
ioctl \
keypad \
lstat \
ltostr \
malloc \
memmove \
mkstemp \
mktemp \
open \
opendir \
pclose \
perror \
popen \
printf \
putenv \
puts \
readdir \
readlink \
realloc \
rename \
rewind \
rewinddir \
seekdir \
setbuf \
setegid \
setgrent \
setlinebuf \
setpwent \
setrgid \
setruid \
sprintf \
sscanf \
strchr \
strerror \
strrchr \
strtok \
strtol \
symlink \
system \
tcgetattr \
telldir \
tgetent \
tgetnum \
time \
tolower \
toupper \
ungetc \
utime \
vfork \
wait \
)

### DataItems/Structs
TD_SYS_ERRLIST
TD_GMTOFF

### DataTypes
TD_DEV_T
TD_INO_T
TD_MODE_T
AC_OFF_T
AC_UID_T
AC_VFORK
AC_TIME_WITH_SYS_TIME
TD_PROGRAM_FULLPATH(DEFAULT_EDITOR, vi $EDITOR)
TD_PROGRAM_FULLPATH(DEFAULT_BROWSE, view $BROWSE)
TD_PROGRAM_FULLPATH(DEFAULT_PAGER, more $PAGER less most)

###	output config.h
#
#	This bypasses the normal autoconf process because we're generating an
#	arbitrary number of NEED_xxxx definitions with the TD_HAVE_FUNCS macro. 
#	Rather than populate an aclocal.h file with all of those definitions,
#	we do it here.
#
###
changequote({,})dnl
AC_OUTPUT(td_make,
{
echo creating support/td_lib.mk
if ( cmp -s td_make support/td_lib.mk 2>/dev/null )
then
	echo "support/td_lib.mk is unchanged"
	rm -f td_make
else
	rm -f support/td_lib.mk
	mv td_make support/td_lib.mk
fi
if test -f confdefs.h
then
	echo creating include/config.h
	echo '/* generated by configure-script */' >config.h
	cat confdefs.h >>config.h
	if ( cmp -s config.h include/config.h 2>/dev/null )
	then
		echo "include/config.h is unchanged"
		rm -f config.h
	else
		mv config.h include
	fi
fi
}
)
changequote([,])dnl
