# $Id: makefile.in,v 12.6 1997/09/10 00:15:47 tom Exp $
# Top-level makefile for TD_LIB common library

####### (Development) ##########################################################

SHELL		= /bin/sh
@SET_MAKE@

RM	= -rm -f
TOP	= ..
THIS	= td_lib
THAT	= libtd

prefix		= @prefix@
exec_prefix	= @exec_prefix@
includedir	= @includedir@
libdir		= @libdir@
srcdir		= @srcdir@

my_incdir	= $(includedir)/td

INSTALL		= @INSTALL@
INSTALL_PROGRAM	= @INSTALL_PROGRAM@
INSTALL_DATA	= @INSTALL_DATA@
RANLIB		= @RANLIB@

I_CFG	= include/td_config.h
MDEFN	= support/td_lib.mk
I_LIST	= `cat $(srcdir)/include/headers`

CLEAN	= *.bak *.log *.out *.tst .nfs* core
PURE	= stamp-* config_h *.cache *.status $(I_CFG) $(MDEFN)
DESTROY	=$(SHELL) -c 'for i in *;do case $$i in RCS);; *) $(RM) $$i;;esac;done;exit 0'

####### (Standard Lists) #######################################################
CONFIG_H=\
	aclocal.m4\
	configure.in

SOURCES	=\
	td_make.in\
	descrip.mms\
	README\
	COPYING\
	$(CONFIG_H)

MFILES	=\
	certify/Makefile\
	include/Makefile\
	support/Makefile

####### (Standard Productions) #################################################
all\
lintlib\
install::	lib $(I_CFG) $(MDEFN)

clean\
clobber ::	td_make.in
	$(SHELL) -c "if test ! -f $(MDEFN);\
		then sed -e's/^MAKE.*/MAKE=make/' td_make.in >$(MDEFN);\
		fi"
all\
clean\
clobber\
run_test\
sources\
lint.out ::	$(MFILES)
	cd support &&	$(MAKE) $@
	cd certify &&	$(MAKE) $@
	cd include &&	$(MAKE) $@
	cd src &&	$(MAKE) $@
	cd test &&	$(MAKE) $@

lintlib ::	$(MFILES)
	cd include &&	$(MAKE) $@

all\
sources ::	$(SOURCES)

clean \
clobber ::			; $(RM) $(CLEAN)
clobber ::			; $(RM) -r lib

distclean:	clobber
	- cd src &&	$(MAKE) $@
	- cd test &&	$(MAKE) $@
	- $(RM) $(PURE)
	- $(RM) config.log config.cache config.status
	- $(RM) makefile */makefile

install::	all $(my_incdir) $(libdir)
	$(srcdir)/support/ins_hdr "$(INSTALL_DATA)" $(my_incdir) $(I_LIST)
	$(INSTALL_DATA) lib/$(THAT).a $(libdir)
	$(RANLIB) $(libdir)/$(THAT).a

deinstall::
	$(srcdir)/support/rem_hdr $(my_incdir) $(I_LIST)
	$(RM) $(libdir)/$(THAT).a

####### (Details of Productions) ###############################################
$(my_incdir) \
$(libdir) \
lib:					; $(srcdir)/mkdirs.sh $@
